Overview
This repository contains the data and code associated with the manuscript:

An Open-Source Tool Adapted to Assess Vessel Strike Risk by Vessel Type for Endangered Whales in San Francisco Bay
Authors: Rebekah S. Lane, Max Czapanskiy, Thomas J. Moore, William Keener, Lisabet M. Hortensius, Jerry Davis, Tim M. Markowitz, Ellen Hines
Journal: Marine Pollution Bulletin, in submission
DOI: to be updated upon acceptance

Contents
data/: Raw and processed datasets used in the study, separated by ais, whales, and studyarea. Not included in github due to size. Find anonymized dataset at 10.5281/zenodo.15198963. 

scripts/: Scripts used for data processing and analysis. 

outputs/: Output files generated by the code. Not included in github. Create your own empty folder for your outputs.

figures/: Scripts to make several final figures used in the manuscript and figures produced. Create your own empty folder for your figures.


Requirements
This project was developed using the following software and packages:

Language: R 

Required packages/libraries:

googlesheets4
here
sf
tidyverse
readr
lubridate
terra
tmap
spatstat
ggplot2
extrafont
showtext
patchwork
ggrepel
raster

Software version(s):

R version 4.4.3

Description of Data

data/ais: This contains ais data from marinecadastre.gov for each month and year included in the study.
data/studyarea: Polygon shapefile of the study area, created by Bekah Lane.
data/whales: Anonymized whale sightings data curated by The Marine Mammal Center by year. 

Description of Scripts

01_reclassifyvesseltype.R:
This script reads in two reclassification tables from Google Sheets, as well as all files in the data/ais path. There is a separate passenger_reclass sheet because we chose to further separate the Passenger vessel class to Cruise, High speed Ferry, and Other Passenger. The function ais_reclass goes through each of the data/ais csv files and reclassifies the vessel classes from the original AIS vessel class designations to the 7 vessel types used in our study (Cargo, Tanker, Tug/Tow, Passenger, Cruise, High speed Ferry, Pleasure). 

02_removeSOGoutliers.R:
This script reads in all ais_reclass RDS files, and removes erroneous outliers using the InterQuartile Range method. It then splits the AIS data into seasons and creates an ais_seasons RDS file. 

03_vesselrasterizeyears.R
This script creates rasters of each ais data file by season and year, then converts them to polygons and gives thema rating of 1, 2, or 3 based on the raster quantile. These rasters are saved to the outputs/ais folder and are the final ais inputs for the InVEST model.

04_whalekde.R
This script reads in select columns from the data/whales csvs, combines them into one whales_all dataframe, creates a season delineation, creates kernel density rasters, then saves these as polygons with 1, 2, 3 ratings based on the raster quantiles. The whale distributions are saved as polygons in outputs/whales, and these .shp files are the final whale inputs for the InVEST model. 

05_speedrasterizeyearsv3.R
This script creates raster files of weighted average speed using the 'SOG' attribute in the ais data. It creates one raster for each season and vessel type for speed. Then, they are converted to polygons and saved to the outputs/speed folder. This is considered a "spatially-explicit criteria" in the InVEST model (file path included in the rating criteria files). 

06_likelihood.R
This script creates raster files of whale and vessel polygons added together. It creates one raster for each season and vessel type for whale/vessel overlap. Then, they are converted to polygons and saved to the ouputs/likelihood folder. This is considered a "spatially-explicit criteria" in the InVEST model (file path included in the rating criteria files). 

In the figures/ folder, there are three scripts to make Manuscript Figures 4 (Area of High, Medium, and Low vessel distribution and speed by vessel type) , 6 (speed distribution by vessel type), and 8 (exposure/consequence and percent area of high, medium, and low risk by vessel type). 

Notes
All data have been anonymized/de-identified where appropriate.

The code has been tested and run on Windows 11.

For questions, contact Bekah Lane at blane@coastalstudies.org (ORCID: https://orcid.org/0000-0002-7377-4360).

License
You are free to use, adapt, and share this code with appropriate attribution to Bekah Lane. Use of data should be communicated with and attributed to The Marine Mammal Center.
